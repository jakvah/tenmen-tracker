<!DOCTYPE html>
<html>
<title>Seasons / Tenman Tracker</title>
{% extends "tenman/navbar.html" %}
{% block body %}
<body>
    <div class="container">
        <h4 style="padding-top: 3px;"> Tenman Seasons</h4>
    </div>

    <div class="container">
        <div class="input-group">                                            
            <input type="TextBox" ID="datebox" Class="form-control"></input>
            <div class="input-group-btn">
                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                    Select season<span class="caret"></span>
                </button>
                <ul id="demolist" class="dropdown-menu">
                    <li><a href="#">December 2020</a></li>
                    <li><a href="#">January 2021</a></li>
                    
                </ul>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="table-responsive">
                <table class="table table-hover" id=datalist>                              

                </table>
            </div>
        </div>    
    </div>
</body>



<!-- Info about data recording modal-->
<!-- Modal -->
<div class="modal fade" id="pointsInfoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">How are points calculated?</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <p>
            Every player starts out with a score of 100. Based on the outcome of the match, every player 
            will win or lose points based on the following criteria
            </p>
            <p>            
            <li style="list-style: None;">
                Points per win: <span style="color:green">+14</span>
            </li>
            <li style="list-style: None;">
                Points per loss: <span style="color:red">-9</span>
            </li>
            </p>
            <strong>Win streak bonus</strong>
            <br>
            <li style="list-style:None">
                Wins required: <span style="color:green">+5</span><span style="color:orange"><i class="fa fa-fire" style="padding-left:3px;"></i></span>
            </li>
            <li style="list-style:None">
                Bonus points: <span style="color:green">+5</span>
            </li>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  
<style>
    #clickableIcon {
          cursor: pointer  
      }
    .tablecenter {
        text-align:center;
    }
</style>

<!-- Script for extracting data from the season database -->
<script>
$('#demolist li').on('click', function(){
   x = $('#datebox').val($(this).text());
   month = $("#datebox").val();
   table_name = "players_" + month.slice(0,3);
   console.log(table_name);

    // Get table data
    $.ajax({
        method:"post",
        url:"/tenman/get_season_data",
        data:{text:table_name},
        success:function(res){
            console.log(res)
            var data;
            data += '<thead> \
                      <tr> \
                        <th scope="col">Position</th> \
                        <th scope="col">Player</th> \
                        <th scope="col" class="text-center">Matches</th>\
                        <th scope="col" class="text-center">Won</th> \
                        <th scope="col" class="text-center">Win %</th> \
                        <th scope="col" class="text-center">Current win streak</th> \
                        <th scope="col" class="text-center">Points<span id="clickableIcon"><i class="fa fa-info-circle fa-sm" style="padding-left:3px;" data-toggle="modal" data-target="#pointsInfoModal"></i></span></th> \
                      </tr> \
                    </thead>';
            $.each(res,function(index,value){
                data += '<tr>';
                data += '<td>' + (index+1).toString() + '</td>';
                data += '<td><a href="/tenman/user/'+value[0]+'"</a>'+'<img src="'+value[2] + '" height="20" width="20" style="margin-right: 3px;;">' + value[1]+"</td>";
                data += '<td class="tablecenter">' + (value[6] + value[7]) + '</td>';
                data += '<td class="tablecenter">' + value[6] + '</td>';
                data += '<td class="tablecenter">' + Math.round((value[6] / (value[6] + value[7]))*100) + '%</td>'
                
                if (value[8] == 0){
                    data += '<td class="tablecenter"> - ';
                }else {                    
                    data += '<td class="tablecenter"><span style="color:green;"> +' + value[8] + '</span>';
                    if (value[8] > 4) {
                        data += '<span style="color:orange"><i class="fa fa-fire" style="padding-left:3px;"></i></span>';
                    }
                }
                data += '</td>';
                data += '<td class="tablecenter">' + value[3] + '</td>';
                data+= '</tr>';
            
            });
            data += '</tbody>'
            $("#datalist").html(data);
        }
    })
});

</script>
{% endblock %}
</html>
